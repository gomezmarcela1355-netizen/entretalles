<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>ENTRETALLES – Carrito</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
:root{
  --azul-top:#1e4aa3; --azul-bottom:#315ec9; --rosa:#ff1493; --txt:#ffffff;
  --azul:#0b2f6b; --azul-2:#163f92; --gris-borde:#e6e9f8; --shadow:0 10px 30px rgba(0,0,0,.10);
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#fafbff;color:#102}

/* Header */
header{background:linear-gradient(180deg,var(--azul-top),var(--azul-bottom));color:#fff;padding:24px 16px}
.header-wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:220px 1fr 160px;gap:16px;align-items:center}
.logo{width:200px;height:auto;border-radius:12px;background:#fff;padding:16px;box-shadow:0 3px 10px rgba(0,0,0,.25)}
.brand{text-align:center}
.brand h1{margin:0 0 6px;font-size:34px}
.brand p{margin:0;opacity:.95}
.header-actions{display:flex;justify-content:flex-end}
.profile-btn{display:inline-flex;align-items:center;gap:8px;background:#ffffff22;border:1px solid #ffffff44;border-radius:999px;color:#fff;padding:8px 12px;font-weight:bold;cursor:pointer}

/* Nav */
nav{background:var(--rosa);display:flex;justify-content:center;gap:28px;padding:10px 12px;font-weight:bold}
nav a{color:#fff;text-decoration:none;padding:8px 14px;border-radius:999px}
nav a:hover{background:#ffffff22}

/* Contenido */
.container{max-width:1100px;margin:26px auto;padding:0 16px}

/* Grid carrito */
.grid{display:grid;grid-template-columns:1fr 340px;gap:22px}
@media (max-width:960px){.grid{grid-template-columns:1fr}}

.card{background:#fff;border:1px solid var(--gris-borde);border-radius:14px;box-shadow:var(--shadow)}
.card header{background:transparent;color:#111;padding:16px;border-bottom:1px solid var(--gris-borde)}
.card header h2{margin:0;font-size:18px;color:#0b2f6b}
.card .content{padding:16px}

/* Lista de items */
.item{display:grid;grid-template-columns:84px 1fr 110px 110px 36px;gap:12px;align-items:center;padding:12px;border-bottom:1px solid #f0f2ff}
.item:last-child{border-bottom:none}
.thumb{width:84px;height:84px;border-radius:10px;border:1px solid #eef1ff;object-fit:cover;background:#fff}
.title{font-weight:bold;color:#163f92}
.sub{color:#456;font-size:13px;margin-top:4px}
.qty{display:flex;align-items:center;gap:8px}
.qty button{width:30px;height:30px;border-radius:8px;border:1px solid #dbe3ff;background:#fff;cursor:pointer}
.price{text-align:right;font-weight:bold}
.remove{display:flex;align-items:center;justify-content:center}
.remove button{background:#ffe8ea;border:1px solid #ffd0d6;color:#b12032;border-radius:8px;padding:6px;cursor:pointer}

.empty{padding:22px;text-align:center;color:#456}

/* Resumen */
.totals{display:flex;flex-direction:column;gap:10px}
.row{display:flex;justify-content:space-between}
.total{font-size:20px;font-weight:800;color:#0b2f6b}

.btn{display:block;width:100%;text-align:center;font-weight:bold;color:#fff;border-radius:12px;padding:12px 14px;text-decoration:none;border:none;cursor:pointer}
.btn-primary{background:var(--azul)}
.btn-primary:hover{filter:brightness(1.05)}
.btn-sec{background:var(--azul-2);margin-top:10px}
.btn-light{background:#fff;border:1px solid #dbe3ff;color:#0b2f6b}
.btn-block{display:block;width:100%}

.actions{display:flex;gap:10px;margin-top:12px}
@media (max-width:480px){.item{grid-template-columns:64px 1fr 88px 88px 32px}.thumb{width:64px;height:64px}}

/* Modal Mi cuenta */
.modal-backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:2000;align-items:center;justify-content:center;padding:16px}
.modal{width:100%;max-width:520px;background:#fff;border-radius:14px;box-shadow:0 12px 34px rgba(0,0,0,.25);overflow:hidden}
.modal header{background:linear-gradient(180deg,var(--azul-top),var(--azul-bottom));color:#fff;padding:14px 16px}
.modal .content{padding:16px}
.form-row{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
.input{padding:10px;border:1px solid #cfd6ff;border-radius:8px;font-size:15px}
.form-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}

footer{margin:28px 0 18px;text-align:center;color:#678}
</style>
</head>
<body>

<header>
  <div class="header-wrap">
    <img class="logo" src="https://i.postimg.cc/852rV0T7/Whats-App-Image-2025-03-26-at-12-46-00.jpg" alt="Logo">
    <div class="brand"><h1>ENTRETALLES</h1><p>Carrito de compras</p></div>
    <div class="header-actions">
      <button id="openProfile" class="profile-btn">Mi cuenta</button>
    </div>
  </div>
</header>

<nav>
  <a href="index.html">Inicio</a>
  <a href="digital.html">Digital</a>
  <a href="fisica.html">Física</a>
</nav>

<div class="container">
  <div class="grid">
    <!-- Columna izquierda: lista -->
    <div class="card">
      <header><h2>Productos</h2></header>
      <div class="content" id="itemsBox"></div>
    </div>

    <!-- Columna derecha: totales -->
    <div class="card">
      <header><h2>Resumen</h2></header>
      <div class="content">
        <div class="totals">
          <div class="row"><span>Subtotal</span><span id="subtotal">$0</span></div>
          <div class="row"><span>Envío</span><span id="shipping">$0</span></div>
          <div class="row total"><span>Total</span><span id="total">$0</span></div>
          <button class="btn btn-primary" id="checkoutBtn">Finalizar compra</button>
          <div class="actions">
            <a class="btn btn-light btn-block" href="digital.html">Seguir comprando</a>
            <button class="btn btn-sec btn-block" id="clearBtn">Vaciar carrito</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>© 2025 Entretalles. Todos los derechos reservados.</footer>
</div>

<!-- Modal Mi cuenta -->
<div class="modal-backdrop" id="buyerModal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="buyerTitle">
    <header><h3 id="buyerTitle" style="margin:0">Datos del comprador</h3></header>
    <div class="content">
      <div class="form-row"><label>Nombre y apellido</label><input class="input" id="buyerName" type="text" placeholder="tu nombre"></div>
      <div class="form-row"><label>Teléfono</label><input class="input" id="buyerPhone" type="tel" placeholder="12345678"></div>
      <div class="form-row"><label>Email</label><input class="input" id="buyerEmail" type="email" placeholder="cliente@mail.com"></div>
      <div class="form-actions">
        <button class="btn btn-light" id="closeBuyer">Cerrar</button>
        <button class="btn btn-primary" id="saveBuyer">Guardar</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ====== CARRITO UNIFICADO + MIGRACIÓN CLAVES VIEJAS ====== */
function getCart(){
  let c = [];
  try { c = JSON.parse(localStorage.getItem('entretalles_cart') || '[]'); } catch(e){ c = []; }
  // migrar de claves viejas si existen
  const legacyKeys = ['entretalles_cart_v1','cart','carrito','shoppingCart','entretallesCart'];
  legacyKeys.forEach(k=>{
    try{
      const v = JSON.parse(localStorage.getItem(k) || '[]');
      if (Array.isArray(v) && v.length) c = c.concat(v);
      localStorage.removeItem(k);
    }catch(e){}
  });
  localStorage.setItem('entretalles_cart', JSON.stringify(c));
  return c;
}
function setCart(c){ localStorage.setItem('entretalles_cart', JSON.stringify(c || [])); }

function fmt(n){ return '$' + (Math.round((n||0)*100)/100).toLocaleString('es-AR'); }

/* ====== RENDER ====== */
const itemsBox = document.getElementById('itemsBox');
const elSubtotal = document.getElementById('subtotal');
const elShipping = document.getElementById('shipping');
const elTotal    = document.getElementById('total');

function render(){
  const cart = getCart();
  itemsBox.innerHTML = '';
  if(!cart.length){
    itemsBox.innerHTML = '<div class="empty">Tu carrito está vacío.</div>';
  }else{
    cart.forEach((it,idx)=>{
      it.qty = it.qty || 1;
      const item = document.createElement('div');
      item.className = 'item';
      item.innerHTML = `
        <img class="thumb" src="${it.image||''}" alt="${it.name||''}">
        <div>
          <div class="title">${it.name||''}</div>
          <div class="sub">${it.category||''}</div>
        </div>
        <div class="qty">
          <button onclick="decQty(${idx})">−</button>
          <span id="q${idx}">${it.qty}</span>
          <button onclick="incQty(${idx})">+</button>
        </div>
        <div class="price" id="p${idx}">${fmt((it.price||0)*it.qty)}</div>
        <div class="remove"><button title="Quitar" onclick="removeItem(${idx})">✕</button></div>
      `;
      itemsBox.appendChild(item);
    });
  }
  updateTotals();
}

function updateTotals(){
  const cart = getCart();
  const subtotal = cart.reduce((s,it)=> s + (it.price||0)*(it.qty||1), 0);
  const shipping = 0;
  const total = subtotal + shipping;
  elSubtotal.textContent = fmt(subtotal);
  elShipping.textContent = fmt(shipping);
  elTotal.textContent    = fmt(total);
}

function incQty(i){ const c=getCart(); if(!c[i])return; c[i].qty=(c[i].qty||1)+1; setCart(c); render(); }
function decQty(i){ const c=getCart(); if(!c[i])return; c[i].qty=Math.max(1,(c[i].qty||1)-1); setCart(c); render(); }
function removeItem(i){ const c=getCart(); c.splice(i,1); setCart(c); render(); }

document.getElementById('clearBtn').addEventListener('click', ()=>{
  if(confirm('¿Vaciar el carrito?')){ setCart([]); render(); }
});

/* ====== Perfil / Comprador ====== */
function getBuyer(){ try{ return JSON.parse(localStorage.getItem('entretalles_buyer')||'{}'); }catch(e){ return {}; } }
function setBuyer(d){ localStorage.setItem('entretalles_buyer', JSON.stringify(d||{})); }

const buyerModal=document.getElementById('buyerModal');
const openProfile=document.getElementById('openProfile');
const closeBuyer=document.getElementById('closeBuyer');
const saveBuyer=document.getElementById('saveBuyer');
const nameInput=document.getElementById('buyerName');
const phoneInput=document.getElementById('buyerPhone');
const emailInput=document.getElementById('buyerEmail');

function loadBuyer(){
  const d = getBuyer();
  nameInput.value  = d.name  || 'tu nombre';
  phoneInput.value = d.phone || '12345678';
  emailInput.value = d.email || '';
}
function showBuyer(){ loadBuyer(); buyerModal.style.display='flex'; }
function hideBuyer(){ buyerModal.style.display='none'; }

openProfile.addEventListener('click', showBuyer);
closeBuyer.addEventListener('click', hideBuyer);
buyerModal.addEventListener('click', e=>{ if(e.target===buyerModal) hideBuyer(); });

saveBuyer.addEventListener('click', ()=>{
  const data = {
    name:  (nameInput.value||'').trim(),
    phone: (phoneInput.value||'').trim(),
    email: (emailInput.value||'').trim()
  };
  if(!data.name || !data.phone || !data.email){
    alert('Completá nombre, teléfono y email.'); return;
  }
  setBuyer(data);
  hideBuyer();
});

/* ====== Checkout a Mercado Pago por alias ====== */
const MP_ALIAS_URL = 'https://link.mercadopago.com.ar/marcelamodelista';

document.getElementById('checkoutBtn').addEventListener('click', ()=>{
  const cart = getCart();
  if(!cart.length){ alert('Tu carrito está vacío.'); return; }
  const buyer = getBuyer();
  if(!(buyer.name && buyer.phone && buyer.email)){
    alert('Antes de finalizar, completá tus datos en “Mi cuenta”.');
    showBuyer(); 
    return;
  }
  const lines = cart.map(it => `• ${it.name} x${it.qty||1} — $${(it.price||0).toLocaleString('es-AR')}`);
  const subtotal = cart.reduce((s,it)=> s + (it.price||0)*(it.qty||1), 0);
  const msg =
`Pedido ENTRETALLES
Cliente: ${buyer.name} | Tel: ${buyer.phone} | Email: ${buyer.email}

Artículos:
${lines.join('\n')}

Total: $${subtotal.toLocaleString('es-AR')}
`;
  const url = MP_ALIAS_URL + '?message=' + encodeURIComponent(msg);
  window.open(url, '_blank');
});

/* init */
render();
</script>
</body>
</html>
